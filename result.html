<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>診断結果</title>
  <style>
    body { font-family: 'M PLUS Rounded 1c', sans-serif; max-width:600px; margin:auto; padding:20px; }
    h1 { text-align:center; margin-bottom:1em; }
    .result { white-space: pre-wrap; font-size:1.2em; text-align:center; }
    .back { margin-top:2em; text-align:center; }
    .back a { color:#26466d; text-decoration:none; font-weight:bold; }
  </style>
</head>
<body>
  <h1>あなたの潜在ランク</h1>
  <div id="result" class="result">読み込み中…</div>
  <div class="back"><a href="index.html">&larr; 診断に戻る</a></div>

  <script>
    (async () => {
      const out = document.getElementById("result");
      out.textContent = "リクエスト中…";

      try {
        // sessionStorageから文字列を取得してパース
        const raw = sessionStorage.getItem("ooo_responses");
        if (!raw) throw new Error("responsesが見つかりません");

        const responses = JSON.parse(raw);
        // { responses: [...] } の形にラップ
        const payload = { responses };

        const res = await fetch("https://ooos-backend.onrender.com/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        console.log("ステータス:", res.status);
        console.log("レスポンスヘッダー:", [...res.headers.entries()]);

        const txt = await res.text();
        console.log("レスポンステキスト:", txt);

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const json = JSON.parse(txt);
        out.textContent =
          `推定ランク：${json.estimated_rank}\n確率：${json.rank_probs.map(p => p.toFixed(2)).join(", ")}`;
      } catch (err) {
        console.error("エラー詳細:", err);
        out.textContent = "サーバーエラーが発生しました。コンソールをご確認ください。";
      }
    })();
  </script>
</body>
</html>
